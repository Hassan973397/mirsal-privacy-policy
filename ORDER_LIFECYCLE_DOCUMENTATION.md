# ๐ฆ ุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ ุงููุงููุฉ - ูุธุงู ูุฑุณุงู

## ๐ฏ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ูุฑุณุงู ูู ูุธุงู ุฅุฏุงุฑุฉ ููุฌุณุชู ูุชูุงูู ูุฏูุฑ ุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจุงุช ูู ุงูุฅูุดุงุก ุญุชู ุงูุชุณููุฉ ุงููุงููุฉ. ูุชุถูู ุงููุธุงู 21 ุญุงูุฉ ูุฎุชููุฉ ููุทูุจุ ูุน ุขููุงุช ุงุญุชุฑุงููุฉ ููุชุญูู ูุงูุชุชุจุน ูุงููุญุงุณุจุฉ.

---

## ๐ ุงููุฑุงุญู ุงูุฑุฆูุณูุฉ ูุฏูุฑุฉ ุญูุงุฉ ุงูุทูุจ

### **1๏ธโฃ ูุฑุญูุฉ ุงูุฅูุดุงุก ูุงูุชุฃููุฏ**

#### **1.1 ุญุงูุฉ: `newOrder` (ุฌุฏูุฏ)**
- **ุงููุตู**: ุงูุญุงูุฉ ุงูุฃูููุฉ ุนูุฏ ุฅูุดุงุก ุงูุทูุจ ูู ูุจู ุงูุชุงุฌุฑ
- **ุงููุณุคูู**: ุงูุชุงุฌุฑ (Merchant)
- **ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ**:
  - ุชุนุฏูู ุชูุงุตูู ุงูุทูุจ
  - ุญุฐู ุงูุทูุจ
  - ุทูุจ ุงุณุชูุงู ูู ููุฏูุจ

#### **1.2 ุญุงูุฉ: `pendingReview` (ููุฏ ุงููุฑุงุฌุนุฉ)**
- **ุงููุตู**: ุงูุทูุจ ูู ุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ูู ุงูุฅุฏุงุฑุฉ
- **ุงููุณุคูู**: ุงูุฅุฏุงุฑุฉ/ุงููุณูุท (Owner/Mediator)
- **ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ**:
  - ุงูููุงููุฉ ุนูู ุงูุทูุจ โ `confirmed`
  - ุฑูุถ ุงูุทูุจ
  - ุทูุจ ูุนูููุงุช ุฅุถุงููุฉ

#### **1.3 ุญุงูุฉ: `confirmed` (ูุคูุฏ)**
- **ุงููุตู**: ุงูุทูุจ ุฌุงูุฒ ููุงุณุชูุงู ูู ุงูุชุงุฌุฑ
- **ุงููุณุคูู**: ุงููุธุงู
- **ุงูุชุงูู**: ุงูุชุธุงุฑ ุฅุณูุงุฏ ูููุฏูุจ ุงุณุชูุงู

---

### **2๏ธโฃ ูุฑุญูุฉ ุงูุงุณุชูุงู ูู ุงูุชุงุฌุฑ**

#### **2.1 ุญุงูุฉ: `assigned` (ูุนููู)**
- **ุงููุตู**: ุชู ุฅุณูุงุฏ ุงูุทูุจ ูููุฏูุจ ุงุณุชูุงู
- **ุงููุณุคูู**: ุงูุฅุฏุงุฑุฉ/ุงููุธุงู
- **ุงูุญููู ุงููููุฉ**:
  - `assignedDriverId`: ูุนุฑู ููุฏูุจ ุงูุงุณุชูุงู
  - `merchantCount`: ุนุฏุฏ ุงููุทุน ุญุณุจ ุงูุชุงุฌุฑ
  - `batchId`: ุฑูู ุงูุฏูุนุฉ (ุฅุฐุง ูุงู ุถูู ุฏูุนุฉ)

#### **2.2 ุญุงูุฉ: `pickedUp` (ุชู ุงูุงุณุชูุงู)**
- **ุงููุตู**: ุงูููุฏูุจ ุงุณุชูู ุงูุทูุจ ูู ุงูุชุงุฌุฑ
- **ุงููุณุคูู**: ููุฏูุจ ุงูุงุณุชูุงู (Pickup Agent)
- **ุขููุฉ ุงูุชุญูู**:
  - ูุณุญ ุงูุจุงุฑููุฏ โ `barcodeVerified = true`
  - ุชุณุฌูู ุนุฏุฏ ุงููุทุน โ `pickupCount`
  - ุชุณุฌูู ููุช ุงูุงุณุชูุงู โ `barcodeVerifiedAt`

**โ๏ธ ูุงุนุฏุฉ ูููุฉ**: 
- ุฅุฐุง `merchantCount != pickupCount` โ ูุธูุฑ ุชูุจูู ุชูุงูุถ
- ุฅุฐุง ูู ูุชู ูุณุญ ุงูุจุงุฑููุฏ โ ูุธูุฑ ูู ูุงุฆูุฉ "ุทูุจุงุช ุจุญุงุฌุฉ ููุชุญูู"

---

### **3๏ธโฃ ูุฑุญูุฉ ุงูุชุญูู ูู ุงููุฎุฒู**

#### **3.1 ุญุงูุฉ: `warehouseReceived` (ูู ุงููุฎุฒู)**
- **ุงููุตู**: ุงูุทูุจ ูุตู ูููุฎุฒู ูุชู ุงูุชุญูู ููู
- **ุงููุณุคูู**: ููุธู ุงููุฎุฒู (Warehouse)
- **ุขููุฉ ุงูุชุญูู**:
  - ูุญุต ุนุฏุฏ ุงููุทุน โ `warehouseCount`
  - ุชุณุฌูู ุงููุชุญูู โ `warehouseVerifiedBy`
  - ุชุณุฌูู ููุช ุงูุชุญูู โ `warehouseVerifiedAt`
  - ููุงุญุธุงุช ุงูุชูุงูุถ โ `discrepancyNotes`

**๐ ููุทู ุงูุชุญูู**:
```
ุฅุฐุง merchantCount == pickupCount == warehouseCount
  โ ูุง ุชูุฌุฏ ูุดููุฉ
ูุฅูุง
  โ ุชุธูุฑ ูู ูุงุฆูุฉ "ุทูุจุงุช ุจูุง ุชูุงูุถุงุช"
```

#### **3.2 ุญุงูุฉ: `warehouseApproved` (ููุงูู ุนููู)**
- **ุงููุตู**: ุงููุฎุฒู ูุงูู ุนูู ุงูุทูุจ (ูุง ุชูุฌุฏ ูุดุงูู ูุจูุฑุฉ)
- **ุงููุณุคูู**: ููุธู ุงููุฎุฒู
- **ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ**:
  - ุฅุณูุงุฏ ูููุฏูุจ ุชูุตูู ุฏุงุฎูู
  - ุฅุถุงูุฉ ููุงุฆูุฉ ุงูุทูุจุงุช ุงูุฌุงูุฒุฉ ููุชูุตูู

#### **3.3 ุญุงูุฉ: `warehouseRejected` (ูุฑููุถ)**
- **ุงููุตู**: ุงููุฎุฒู ุฑูุถ ุงูุทูุจ (ุชูุงูุถ ูุจูุฑ/ุจุถุงุนุฉ ุชุงููุฉ)
- **ุงููุณุคูู**: ููุธู ุงููุฎุฒู
- **ุงูุฅุฌุฑุงุกุงุช ุงูุชููุงุฆูุฉ**:
  - ุฅูุดุงุก ุชูุฑูุฑ ูุฒุงุน
  - ุฅุดุนุงุฑ ููุฅุฏุงุฑุฉ ูุงูุชุงุฌุฑ ูุงูููุฏูุจ
  - ุชุณุฌูู ูู ุณุฌู ุงูุชุฏููู

---

### **4๏ธโฃ ูุฑุญูุฉ ุงูุชูุตูู ููุนููู**

#### **4.1 ุฅุณูุงุฏ ููุชูุตูู ุงูุฏุงุฎูู**
- **ุงูุฅุฌุฑุงุก**: `WarehouseService.assignOrdersToInternal()`
- **ุงูุญููู ุงููุญุฏุซุฉ**:
  - `internalCourierId`: ูุนุฑู ููุฏูุจ ุงูุชูุตูู
  - `status` โ `outForDelivery`
  - `internalReceivedAt`: ููุช ุงูุฅุณูุงุฏ

**๐ฐ ูุงุนุฏุฉ ูุญุงุณุจูุฉ ูููุฉ**:
ุนูุฏ ุงูุฅุณูุงุฏ ููุชูุตูู ุงูุฏุงุฎูู:
- ููุญุชุณุจ ุฃุฌุฑ ููุฏูุจ ุงูุงุณุชูุงู ุชููุงุฆูุงู
- ููุฑุณู ุฅุดุนุงุฑ ูููุฏูุจ ุงูุงุณุชูุงู ุจุฃู ุฃุฌุฑู ุฃุตุจุญ ูุณุชุญูุงู

#### **4.2 ุญุงูุฉ: `outForDelivery` (ูู ุงูุทุฑูู)**
- **ุงููุตู**: ููุฏูุจ ุงูุชูุตูู ุงูุฏุงุฎูู ูุญูู ุงูุทูุจ ููุชูุฌู ููุนููู
- **ุงููุณุคูู**: ููุฏูุจ ุงูุชูุตูู ุงูุฏุงุฎูู (Internal Delivery)
- **ุงูุฅุฌุฑุงุกุงุช ุงููุชุงุญุฉ**:
  - ุชุณููู ูุงุฌุญ โ `delivered`
  - ุชุฃุฌูู โ `deferred`
  - ูุดู ุงูุชุณููู โ `failed`
  - ุฅุฑุฌุงุน ุฌุฒุฆู โ `partialReturn`

---

### **5๏ธโฃ ูุฑุญูุฉ ุฅุชูุงู ุงูุชุณููู**

#### **5.1 ุญุงูุฉ: `delivered` (ุชู ุงูุชุณููู)**
- **ุงููุตู**: ุชู ุชุณููู ุงูุทูุจ ููุนููู ุจูุฌุงุญ
- **ุงููุณุคูู**: ููุฏูุจ ุงูุชูุตูู ุงูุฏุงุฎูู
- **ุขููุฉ ุฅุซุจุงุช ุงูุชุณููู** (`DeliveryProof`):
  - ุฑูุฒ OTP ูู ุงูุนููู
  - ุตูุฑุฉ ููุทูุจ ุงูููุณููู
  - ุชูููุน ุงูุนููู (ุงุฎุชูุงุฑู)
  - ุฅุญุฏุงุซูุงุช GPS ูููููุน
  - ููุช ุงูุชุณููู

**๐ฐ ุงูููุงุนุฏ ุงููุญุงุณุจูุฉ**:
1. **ุงูุชุงุฌุฑ**:
   - ูุณุชุญู ูููุฉ ุงูุจุถุงุนุฉ (`amount`) ููุท
   - ุงูุญุงูุฉ: `delivered` โ ูุนูู (Pending)

2. **ููุฏูุจ ุงูุชูุตูู ุงูุฏุงุฎูู**:
   - ูุณุชุญู ุฃุฌุฑู (`internalDeliveryRate`) ุจุงููุงูู
   - ุงูุญุงูุฉ: `delivered` โ ูุนูู (Pending)

3. **ุงูุดุฑูุฉ**:
   - ุชุญุตู ุนูู ุฑุณูู ุงูุชูุตูู (`deliveryFee`)

#### **5.2 ุญุงูุฉ: `deferred` (ูุคุฌูุฉ)**
- **ุงููุตู**: ุงูุนููู ุทูุจ ุชุฃุฌูู ุงูุชุณููู
- **ุงููุฏุฉ**: 72 ุณุงุนุฉ ูุญุฏ ุฃูุตู
- **ุงูุญููู ุงููููุฉ**:
  - `deferredAt`: ููุช ุงูุชุฃุฌูู
  - `deferredUntil`: ุงูููุนุฏ ุงููุญุฏุฏ ููุชุณููู

**โฐ ุขููุฉ ุงูุชุฃุฌูู ุงูุชููุงุฆู**:
```javascript
if (deferredAt + 72 hours < now) {
  status = 'delivered' (ููุญุชุณุจ ูุงุตู ุชููุงุฆูุงู)
  notes += 'ุงูุชูุช ูููุฉ ุงูุชุฃุฌูู ูุชู ุงุญุชุณุงุจ ุงูุทูุจ ูุงุตู'
  // ุฅุดุนุงุฑุงุช ููุฅุฏุงุฑุฉ ูุงูุชุงุฌุฑ ูุงูููุฏูุจ
}
```

#### **5.3 ุญุงูุฉ: `failed` (ูุดู)**
- **ุงููุตู**: ูุดู ุชุณููู ุงูุทูุจ ููุนููู
- **ุงูุฃุณุจุงุจ ุงููุญุชููุฉ**:
  - ุงูุนููู ุฑูุถ ุงูุงุณุชูุงู
  - ุงูุนููุงู ุฎุงุทุฆ
  - ุงููุงุชู ูุบูู
  - ุงูุนููู ุบูุฑ ููุฌูุฏ

**๐ ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ**:
- ุฅุฑุฌุงุน ูููุฎุฒู
- ุงูุชูุงุตู ูุน ุงูุชุงุฌุฑ
- ุฅุนุงุฏุฉ ุฌุฏููุฉ ุงูุชูุตูู

#### **5.4 ุญุงูุฉ: `partialReturn` (ุฑุงุฌุน ุฌุฒุฆู)**
- **ุงููุตู**: ุงูุนููู ุงุณุชูู ุฌุฒุก ููุท ูู ุงูุทูุจ
- **ูุซุงู**: ุทูุจ ููู 3 ูุทุนุ ุงูุนููู ุงุณุชูู 2 ููุท

#### **5.5 ุญุงูุฉ: `replacement` (ุงุณุชุจุฏุงู)**
- **ุงููุตู**: ุงูุนููู ูุฑูุฏ ุงุณุชุจุฏุงู ุงูููุชุฌ
- **ุงูุฅุฌุฑุงุกุงุช**:
  - ุฅุฑุฌุงุน ุงูููุชุฌ ุงููุฏูู
  - ุชุณููู ุงูููุชุฌ ุงูุฌุฏูุฏ

#### **5.6 ุญุงูุฉ: `returned` (ุฑุงุฌุน)**
- **ุงููุตู**: ุชู ุฅุฑุฌุงุน ุงูุทูุจ ุจุงููุงูู
- **ุงูุฅุฌุฑุงุกุงุช ุงูุชุงููุฉ**:
  - ุฅุฑุฌุงุน ูููุฎุฒู
  - ุชุฃููุฏ ุงูุฅุฑุฌุงุน ูู ุงููุฎุฒู โ `returnConfirmed`

#### **5.7 ุญุงูุฉ: `returnConfirmed` (ุฑุงุฌุน ูุคูุฏ)**
- **ุงููุตู**: ุงููุฎุฒู ุงุณุชูู ูุฃูุฏ ุฅุฑุฌุงุน ุงูุทูุจ
- **ุงููุญุงุณุจุฉ**:
  - ูุง ููุญุชุณุจ ุฃุฌุฑ ูุฃู ุทุฑู
  - ูุง ููุฌุฏ ูุณุชุญูุงุช

---

### **6๏ธโฃ ูุฑุญูุฉ ุงููุนุงูุฌุฉ ุงููุญุงุณุจูุฉ**

#### **6.1 ุญุงูุฉ: `inProcessing` (ููุฏ ุงููุนุงูุฌุฉ)**
- **ุงููุตู**: ุงูุทูุจ ูู ูุฑุญูุฉ ุงููุฑุงุฌุนุฉ ุงููุงููุฉ
- **ุงููุณุคูู**: ุงููุญุงุณุจ (Accountant)
- **ุงูุฅุฌุฑุงุกุงุช**:
  - ูุฑุงุฌุนุฉ ุชูุงุตูู ุงูุทูุจ
  - ุงูุชุญูู ูู ุงููุจุงูุบ
  - ุฅุนุฏุงุฏ ููุชุณููุฉ

#### **6.2 ุญุงูุฉ: `processed` (ุชูุช ุงููุนุงูุฌุฉ)**
- **ุงููุตู**: ุงูุชููุช ุงููุฑุงุฌุนุฉ ุงููุงููุฉ
- **ุงูุชุงูู**: ุฅูุดุงุก ุชุณููุฉ ูุงููุฉ

---

### **7๏ธโฃ ูุฑุญูุฉ ุงูุชุณููุฉ ุงููุงููุฉ**

#### **7.1 ุญุงูุฉ: `settled` (ูุณููู)**
- **ุงููุตู**: ุชู ุฅูุดุงุก ุชุณููุฉ ูุงููุฉ ูุชู ุงูุฏูุน
- **ุงููุณุคูู**: ุงููุญุงุณุจ/ุงูุฅุฏุงุฑุฉ
- **ุงูุขููุฉ**:

```javascript
Settlement = {
  id: 'STL_timestamp',
  userId: 'merchant_id / driver_id',
  userName: 'ุงุณู ุงูุดุฎุต',
  totalAmount: 'ุฅุฌูุงูู ุงููุณุชุญูุงุช',
  orderIds: ['order1', 'order2', ...],
  status: 'pending' | 'paid',
  notes: 'ููุงุญุธุงุช',
  createdAt: DateTime,
  approvedBy: 'ุงููุญุงุณุจ',
  approvedAt: DateTime
}
```

**๐ผ ุฃููุงุน ุงูุชุณููุงุช**:

1. **ุชุณููุฉ ูุงููุฉ**:
   - ุฌููุน ุงูุทูุจุงุช ุงูููุณูููุฉ ููุทุฑู
   - `settleMerchantAccount()` / `settleDriverAccount()`

2. **ุชุณููุฉ ุฌุฒุฆูุฉ**:
   - ุนุฏุฏ ูุญุฏุฏ ูู ุงูุทูุจุงุช ุฃู ูุจูุบ ูุญุฏุฏ
   - `createPartialMerchantSettlement()`
   - `createPartialDriverSettlement()`

---

## ๐ฐ ุงููุธุงู ุงููุญุงุณุจู ุงููุชูุงูู

### **1. ููุงุนุฏ ุงุณุชุญูุงู ุงูุฃุฌูุฑ**

#### **ุฃ. ููุฏูุจู ุงูุงุณุชูุงู (Pickup Agents)**
```
ุงูุดุฑุท: 
  order.assignedDriverId == pickupAgentId
  AND order.status IN [
    outForDelivery,
    delivered,
    deferred,
    returned,
    settled
  ]

ุงูุฃุฌุฑ = ุนุฏุฏ ุงูุทูุจุงุช ร ุฃุฌุฑ ุงูุทูุจ ุงููุงุญุฏ
ุงูุชูููุช: ุนูุฏ ุงูุฅุณูุงุฏ ููุชูุตูู ุงูุฏุงุฎูู ูู ุงููุฎุฒู
```

#### **ุจ. ููุฏูุจู ุงูุชูุตูู ุงูุฏุงุฎูู (Internal Delivery)**
```
ุงูุดุฑุท:
  order.internalCourierId == internalCourierId
  AND order.status IN [delivered, settled]

ุงูุฃุฌุฑ = ุนุฏุฏ ุงูุทูุจุงุช ร ุฃุฌุฑ ุงูุทูุจ ุงููุงุญุฏ
ุงูุชูููุช: ุนูุฏ ุงูุชุณููู ุงููุงุฌุญ ููุนููู
```

#### **ุฌ. ุงูุชุฌุงุฑ (Merchants)**
```
ุงูุดุฑุท:
  order.merchantId == merchantId
  AND order.status == delivered

ุงููุณุชุญู = order.amount (ูููุฉ ุงูุจุถุงุนุฉ ููุท)
ุฑุณูู ุงูุชูุตูู = deliveryFee (ุชุฐูุจ ููุดุฑูุฉ)
ุงูุชูููุช: ุนูุฏ ุชุณููู ุงูุทูุจ ููุนููู
```

### **2. ุงููุนุงููุงุช ุงููุญุงุณุจูุฉ ุงูุฅุถุงููุฉ**

#### **ุงูููุงูุขุช (Bonuses)**
```javascript
addAdjustment({
  userId: 'driver_id',
  userName: 'ุงุณู ุงูุณุงุฆู',
  amount: 50000,
  type: TransactionType.bonus,
  notes: 'ููุงูุฃุฉ ุนูู ุงูุฃุฏุงุก ุงูููุชุงุฒ'
})
```

#### **ุงูุบุฑุงูุงุช (Penalties)**
```javascript
addAdjustment({
  userId: 'driver_id',
  userName: 'ุงุณู ุงูุณุงุฆู',
  amount: 10000,
  type: TransactionType.penalty,
  notes: 'ุบุฑุงูุฉ ุชุฃุฎูุฑ ูู ุงูุชุณููู'
})
```

### **3. ุญุณุงุจ ุงููุณุชุญูุงุช**

```javascript
// ููุฏูุจ ุงุณุชูุงู
totalEarnings = (completedOrders.count ร ratePerOrder)
              + bonuses
              - penalties

pendingAmount = totalEarnings - paidAmount

// ุชุงุฌุฑ
pendingRevenue = (deliveredOrders.amount)
               + bonuses
               - penalties
               - paidAmount
```

---

## ๐ ุขููุงุช ุงูุชุญูู ูุงูุชุชุจุน

### **1. ุงูุชุญูู ุจุงูุจุงุฑููุฏ**

```javascript
verifyOrderByBarcode(orderId, scannedBarcode) {
  order.barcodeVerified = true
  order.barcodeVerifiedAt = DateTime.now()
  // ุชุณุฌูู ูู Audit Log
}
```

### **2. ุชุชุจุน ุงูุชูุงูุถุงุช**

#### **ุฃ. ุชูุงูุถุงุช ุงูุงุณุชูุงู**
```javascript
// ูุธูุฑ ูููุฎุฒู ุฅุฐุง:
merchantCount != pickupCount
// ุฃู
pickupCount == null
```

#### **ุจ. ุงูุทูุจุงุช ุงูููููุฏุฉ**
```javascript
// ุทูุจุงุช ุฃููุดุฆุช ููู ูู ูุณุชูููุง ุงูููุฏูุจ
status == (newOrder OR confirmed)
AND merchant has other picked orders
```

### **3. ุณุฌู ุงูุชุฏููู (Audit Log)**

ูู ุนูููุฉ ูููุฉ ูุชู ุชุณุฌูููุง:
```javascript
AuditLog = {
  actorId: 'user_id',
  actorName: 'ุงุณู ุงููุณุชุฎุฏู',
  actorEmail: 'email',
  actorRole: 'role',
  action: 'create | update | delete | verify | approve',
  entityType: 'order | warehouse | settlement',
  entityId: 'id',
  summary: 'ูุตู ุงูุฅุฌุฑุงุก ุจุงูุนุฑุจูุฉ',
  metadata: { key-value pairs },
  createdAt: DateTime
}
```

---

## ๐ ูุธุงู ุงูุฅุดุนุงุฑุงุช

### **ุงูุฅุดุนุงุฑุงุช ุงูุชููุงุฆูุฉ:**

1. **ุนูุฏ ุฅูุดุงุก ุทูุจ**: ูุง ุชูุฌุฏ ุฅุดุนุงุฑุงุช (ููุชุธุฑ ุทูุจ ุงูุงุณุชูุงู)

2. **ุนูุฏ ุฅุณูุงุฏ ูููุฏูุจ ุงุณุชูุงู**: ุฅุดุนุงุฑ ููููุฏูุจ

3. **ุนูุฏ ุงูุงุณุชูุงู ูู ุงูุชุงุฌุฑ**: ุฅุดุนุงุฑ ูููุฎุฒู (ุฅุฐุง ูุงู ุชูุงูุถ)

4. **ุนูุฏ ุงูุฅุณูุงุฏ ููุชูุตูู ุงูุฏุงุฎูู**:
   - ุฅุดุนุงุฑ ูููุฏูุจ ุงูุชูุตูู
   - ุฅุดุนุงุฑ ูููุฏูุจ ุงูุงุณุชูุงู (ุชู ุงุญุชุณุงุจ ุฃุฌุฑู)

5. **ุนูุฏ ุงูุชุณููู ููุนููู**:
   - ุฅุดุนุงุฑ ููุชุงุฌุฑ
   - ุฅุดุนุงุฑ ูููุญุงุณุจ

6. **ุนูุฏ ุฅูุดุงุก ุชุณููุฉ**:
   - ุฅุดุนุงุฑ ูููุณุชููุฏ
   - ุฅุดุนุงุฑ ูููุญุงุณุจ ูุงูุฅุฏุงุฑุฉ

7. **ุนูุฏ ุงูุฏูุน**: ุฅุดุนุงุฑ ูููุณุชููุฏ

---

## ๐ ุงูุชูุงุฑูุฑ ุงููุงููุฉ

### **1. ุงูููุฎุต ุงููุงูู ุงูุนุงู**
```javascript
getAccountingSummary() {
  totalOrders,
  deliveredOrders,
  settledOrders,
  pendingOrders,
  totalRevenue,           // ูููุฉ ุงูุจุถุงุฆุน
  totalDeliveryFees,      // ุฑุณูู ุงูุชูุตูู
  totalPickupEarnings,    // ุฃุฌูุฑ ุงูุงุณุชูุงู
  totalInternalEarnings,  // ุฃุฌูุฑ ุงูุชูุตูู
  netProfit = totalDeliveryFees - totalPickupEarnings - totalInternalEarnings,
  profitMargin = (netProfit / totalDeliveryFees) ร 100
}
```

### **2. ููุฎุต ูุงูู ูุชุงุฌุฑ**
```javascript
MerchantFinancialSummary {
  totalRevenue: sum(deliveredOrders.amount),
  totalDeliveryFees: sum(deliveredOrders.deliveryFee),
  paidToMerchant: sum(paidSettlements),
  pendingToMerchant: totalRevenue - paidToMerchant,
  deliveredOrders: count,
  settledOrders: count
}
```

### **3. ููุฎุต ูุงูู ูููุฏูุจ**
```javascript
CourierFinancialSummary {
  totalEarnings: completedOrders ร ratePerOrder,
  paidAmount: sum(paidSettlements),
  pendingAmount: totalEarnings - paidAmount,
  totalOrders: count,
  completedOrders: count,
  ratePerOrder: rate
}
```

### **4. ุชูุฑูุฑ ูุชุฑุฉ ุฒูููุฉ**
```javascript
generateFinancialReport(startDate, endDate) {
  totalRevenue,
  totalDeliveryFees,
  totalPickupCosts,
  totalInternalCosts,
  netProfit,
  profitMargin,
  revenueByMerchant: Map<merchantId, revenue>,
  costsByDriver: Map<driverId, cost>,
  averageOrderValue,
  averageDeliveryFee
}
```

---

## โก ุงูููุฒุงุช ุงููุชูุฏูุฉ

### **1. ุงูุชุญูู ุงูุขูู**
- ูุณุญ ุงูุจุงุฑููุฏ ุนูุฏ ุงูุงุณุชูุงู
- ุงูุชุญูู ูู ุนุฏุฏ ุงููุทุน ูู 3 ูุฑุงุญู
- ูุดู ุงูุชูุงูุถุงุช ุชููุงุฆูุงู

### **2. ุงูุชุฃุฌูู ุงูุชููุงุฆู**
- ูููุฉ 72 ุณุงุนุฉ
- ุชุญููู ุชููุงุฆู ุฅูู `delivered` ุจุนุฏ ุงูุชูุงุก ุงููููุฉ
- ุฅุดุนุงุฑุงุช ุชููุงุฆูุฉ

### **3. ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ุงูููููุฏุฉ**
- ูุดู ุชููุงุฆู
- ุฅุฌุฑุงุกุงุช ุฎุงุตุฉ (ุชุนุฏูู/ุญุฐู/ููุงููุฉ)
- ุฅุดุนุงุฑุงุช ููุฑูุฉ ููุฅุฏุงุฑุฉ
- ุชุณุฌูู ูุงูู ูู Audit Log

### **4. ุงูุชุณููุงุช ุงููุฑูุฉ**
- ุชุณููุงุช ูุงููุฉ
- ุชุณููุงุช ุฌุฒุฆูุฉ (ุจุงููุจูุบ ุฃู ุนุฏุฏ ุงูุทูุจุงุช)
- ุฏูุน ููุฑู ุฃู ูุนูู
- ููุงูุขุช ูุบุฑุงูุงุช

### **5. ุงูุชูุงุฑูุฑ ุงูุงุญุชุฑุงููุฉ**
- ุชูุงุฑูุฑ ููููุฉ/ุดูุฑูุฉ/ุณูููุฉ
- ุชุตุฏูุฑ PDF/CSV/Excel
- ุฑุณูู ุจูุงููุฉ ูุฅุญุตุงุฆูุงุช
- ููุงุฑูุงุช ูุชุญูููุงุช

---

## ๐จ ูุฎุทุท ุชุฏูู ุฏูุฑุฉ ุงูุญูุงุฉ

```
[ุงูุชุงุฌุฑ ูููุดุฆ ุทูุจ]
         โ
    [newOrder]
         โ
  [ุทูุจ ุงุณุชูุงู]
         โ
    [assigned] โ [ููุฏูุจ ุงุณุชูุงู]
         โ
  [ูุณุญ ุจุงุฑููุฏ]
         โ
    [pickedUp]
         โ
    [ูููุฎุฒู]
         โ
  [warehouseReceived] โ [ุงูุชุญูู]
         โ
 [warehouseApproved]
         โ
[ุฅุณูุงุฏ ููุชูุตูู] โ [๐ฐ ุฃุฌุฑ ููุฏูุจ ุงูุงุณุชูุงู]
         โ
  [outForDelivery] โ [ููุฏูุจ ุชูุตูู ุฏุงุฎูู]
         โ
  โโโโโโโดโโโโโโ
  โ           โ
[delivered] [deferred/failed/returned]
  โ
[๐ฐ ุฃุฌูุฑ: ุชุงุฌุฑ + ููุฏูุจ ุชูุตูู]
  โ
[ุงูุชุณููุฉ ุงููุงููุฉ]
  โ
[settled]
```

---

## โ ููุงุท ุงูููุฉ ูู ุงููุธุงู

1. **ุดููููุฉ**: 21 ุญุงูุฉ ุชุบุทู ูู ุงูุณููุงุฑูููุงุช
2. **ุฏูุฉ ูุญุงุณุจูุฉ**: ููุงุนุฏ ูุงุถุญุฉ ูููุตูุฉ ููู ุทุฑู
3. **ุชุชุจุน ูุงูู**: Audit Log + Notifications ููู ุนูููุฉ
4. **ูุฑููุฉ**: ุชุณููุงุช ูุงููุฉ/ุฌุฒุฆูุฉุ ููุงูุขุช/ุบุฑุงูุงุช
5. **ุขููุฉ**: ูุดู ุงูุชูุงูุถุงุชุ ุงูุชุฃุฌูู ุงูุชููุงุฆูุ ุงูุฅุดุนุงุฑุงุช
6. **ุงุญุชุฑุงููุฉ**: ุชูุงุฑูุฑ ููุตูุฉุ ุชุตุฏูุฑ ุจุตูุบ ูุชุนุฏุฏุฉ
7. **ุฃูุงู**: ุชุณุฌูู ูุงููุ ุตูุงุญูุงุช ูุงุถุญุฉ

---

## ๐ ููุงุญุธุงุช ูููุฉ

### **ููุชุฌุงุฑ**
- ูุณุชุญููู `amount` ููุท (ูููุฉ ุงูุจุถุงุนุฉ)
- `deliveryFee` ุชุฐูุจ ููุดุฑูุฉ
- ุงููุณุชุญูุงุช ุชูุญุชุณุจ ุนูุฏ `delivered`
- ุงูุชุณููุฉ ุนุจุฑ ุงููุญุงุณุจ

### **ูููุฏูุจู ุงูุงุณุชูุงู**
- ุงูุฃุฌุฑ ููุญุชุณุจ ุนูุฏ ุงูุฅุณูุงุฏ ููุชูุตูู ุงูุฏุงุฎูู
- ููุณ ุนูุฏ ุงูุชุณููู ููุนููู
- ูุณุชุญููู ุงูุฃุฌุฑ ุญุชู ูู ูุดู ุงูุชูุตูู

### **ูููุฏูุจู ุงูุชูุตูู ุงูุฏุงุฎูู**
- ุงูุฃุฌุฑ ููุญุชุณุจ ุนูุฏ ุงูุชุณููู ุงููุงุฌุญ ููุท
- `delivered` ุฃู ุจุนุฏ ุงูุชูุงุก ูููุฉ ุงูุชุฃุฌูู (72 ุณุงุนุฉ)

### **ูููุฎุฒู**
- ุฏูุฑ ุญุงุณู ูู ุงูุชุญูู ูู ุนุฏุฏ ุงููุทุน
- ุตูุงุญูุฉ ุงูููุงููุฉ/ุงูุฑูุถ
- ุฅุฏุงุฑุฉ ุงูุทูุจุงุช ุงูููููุฏุฉ

### **ูููุญุงุณุจ**
- ุฅุฏุงุฑุฉ ุงูุชุณููุงุช ุงููุงููุฉ
- ุชุทุจูู ุงูููุงูุขุช ูุงูุบุฑุงูุงุช
- ุชูููุฏ ุงูุชูุงุฑูุฑ ุงููุงููุฉ

---

## ๐ง ูููุงุช ุงูููุฏ ุงูุฑุฆูุณูุฉ

- **ุงูููุงุฐุฌ**: `lib/models/order_model.dart`, `accounting_model.dart`
- **ุงูุฎุฏูุงุช**: `lib/services/order_service.dart`, `accounting_service.dart`, `warehouse_service.dart`
- **ุงูุดุงุดุงุช**: `lib/screens/driver/`, `warehouse/`, `merchant/`, `accountant/`
- **ุงูููุฏุฌุชุณ**: `lib/widgets/common/order_status_badge.dart`, `stat_card.dart`

---

**ุชู ุงูุชูุซูู ุจูุงุณุทุฉ**: Hologram AI  
**ุงูุชุงุฑูุฎ**: 2024  
**ุงูุฅุตุฏุงุฑ**: 1.0  
**ุงูุญุงูุฉ**: โ ูุธุงู ูุชูุงูู ูุฌุงูุฒ ููุฅูุชุงุฌ
